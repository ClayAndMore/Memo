## 命令行解析



### argparse

是python自带的一个命令行解析包

#### 默认配置， 配置说明

默认配置，也就是最单纯的写法：test.py

```python
import argparse
parse = argparse.ArgumentParser()
parse.parse_args()
```

这样只有自带的h参数生效： python test.py -h

我们要为文档写些具体信息：

```python
import argparse

parse = argparse.ArgumentParser(
        usage = '==usage==',
        description = '==description==',
        epilog = '==epilog==',
        version = '==version=='
    )

parse.parse_args()
```

out:

```python
[root@claymore argparse]# python args_test.py -h
usage: ==usage==

==description==

optional arguments:
  -h, --help     show this help message and exit
  -v, --version  show program's version number and exit

==epilog==
[root@claymore argparse]# vim args_test.py 
[root@claymore argparse]# vim args_test.py -v
[root@claymore argparse]# python args_test.py -v
==version==
```



#### add_argument

```python
name or flags - 选项字符串的名字或者列表，例如foo 或者-f, --foo。
action - 在命令行遇到该参数时采取的基本动作类型。
nargs - 应该读取的命令行参数数目。
const - 某些action和nargs选项要求的常数值。
default - 如果命令行中没有出现该参数时的默认值。
type - 命令行参数应该被转换成的类型。
choices - 参数可允许的值的一个容器。
required - 该命令行选项是否可以省略（只针对可选参数）。
help - 参数的简短描述。
metavar - 参数在帮助信息中的名字。
dest - 给parse_args()返回的对象要添加的属性名称。
```



#### 带固定参数(位置参数)

不以- , --开头的参数,  argparse 会自动解析。

```python
parser = argparse.ArgumentParser()
parser.add_argument("echo")
args = parser.parse_args()
print args.echo
```

不带参数`python test.py `会有错误提示，正确使用为：

`python test.py hahaha`   输出 hahaha



#### 带可选参数

```python
import argparse parser = argparse.ArgumentParser() 
parser.add_argument("-v", "--verbosity", help="increase output verbosity") 
args = parser.parse_args() 
if args.verbosity:
  	print args.verbosity   # 注意这里, 是转换到程序中具体的值。
	print "verbosity turned on"
```

 通过“-”，“--”来声明可选参数，调用形式：`python test.py --v 1`  1是v代表的参数，

参数通过解析后存在parser.parse_args()中，如果没有给定则会报错。

**action:**

* store :   没有指定为 action='store', 默认动作，只是保存参数的值。

* store_true/store_false:  传递了参数为True, 否则False

  ```python
  如果用那种不用给参数的，像-h,我们需要指定action="store_true"  eg:
  
  parser.add_argument("-v", "--verbose",
                      action="store_true"
                      help="increase output verbosity")
  这时 parse_args()存的是True或False ，通过解析则为True
  ```

* append  传递的参数保存到一个列表，当多次调用参数时会有用。

  ```python
  >>> parser.parse_args('--foo 1 --foo 2'.split())
  Namespace(foo=['1', '2'])
  ```

  

* 







1. 传递不同类型的的参数类型

   ```python
   import argparse parser = argparse.ArgumentParser() 
   parser.add_argument('x', type=int, help="the base") 
   args = parser.parse_args() 
   answer = args.x ** 2
   print answer
   ```

   传参时只能传int，eg:`python test.py 2`

   如果需要参数默认值： `parser.add_argument('x', type=int, help="the base",default=1) `

2. 为参数设立可选值

   ```
   parser.add_argument("-v", "--verbosity", type=int, choices=[0, 1, 2],
                       help="increase output verbosity")
   ```

   这里可以和3中的对比，如果在0，1，2范围外的参数值将报错

3. 提供帮说明

   为整个文档提供帮助说明：

   ``argparse.ArgumentParser(description="calculate X to the power of Y"``

   这时在用帮助参数时会打印上述描述信息。



### docopt

官方库：https://github.com/docopt/docopt

参数解析的库，将py文件的`__doc__`解析出来：

```python
"""val Fate.
 
Usage:
  naval_fate.py ship new <name>...
  naval_fate.py ship <name> move <x> <y> [--speed=<kn>]
  naval_fate.py ship shoot <x> <y>
  naval_fate.py mine (set|remove) <x> <y> [--moored | --drifting]
  naval_fate.py (-h | --help)
  naval_fate.py --version
 
Options:
  -h --help     Show this screen.
  --version     Show version.
  --speed=<kn>  Speed in knots [default: 10].
  --moored      Moored (anchored) mine.
  --drifting    Drifting mine.
 
"""
from docopt import docopt
 
if __name__ == '__main__':
    arguments = docopt(__doc__, version='Naval Fate 2.0')
    print arguments
```



这里只有vesion参数被指定。

