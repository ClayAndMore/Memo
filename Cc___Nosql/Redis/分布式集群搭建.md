3.x后 redis支持了分布式架构

### 集群分片。

集群将整个数据库分为16384个槽位（slot, 可以理解为一个虚拟概念）， key值会和槽位号做映射，slot_number= crc16(key) % 16384,  crc16是16位冗余校验和函数。

```
                 +---------+
                 | client  |
     +-----------+----+----+---------+
     |                |              |
+----+----+     +-----+----+   +-----+----+
|A server |     | B server |   | C server |
+---------+     +----------+   +----------+
 slot 0-5000     slot 5001-1w   slot 10001-16384
```



解决两个问题：

1. 数据暴增，增加服务器时, 为其规划槽位，比如，从 A,B,C 各个拿一千个slot规划到新服务器，同时把数据也拿过去。
2. 数据倾斜，如果放到A 的数据多，那么把A的槽位范围变小，多的槽位归到其他服务器上。

但有个单点故障的问题。

### 主备

所以3.0后，每个节点都认为自己是主节点，也是哨兵。

```
                         +---------+
                         | client  |
             +-----------+----+----+---------+
             |                |              |
        +----+----+     +-----+----+   +-----+----+
   +----+A server +-+   | B server |   | C server |
   |    +---------+ |   +----------+   +----------+
   |     slot 0-5000|    slot 5001-1w   slot 10001-16384
   |                |
+--+----+   +-------+  +------+  +------+   +------+  +-------+
|  slave|   |  slave|  | slave|  |      |   |      |  |       |
+-------+   +-------+  +------+  +------+   +------+  +-------+
```

如A和自己下面两个从节点组成搞可用， 他们每个节点上都有哨兵，互相监控。

既有横向切片功能，又要纵向的镜像全量功能。