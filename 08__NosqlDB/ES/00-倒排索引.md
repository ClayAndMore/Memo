
---
title: "00-倒排索引.md"
date: 2019-10-25 17:50:12 +0800
lastmod: 2019-10-25 17:50:12 +0800
draft: false
tags: [""]
categories: [""]
author: "Claymore"

---
### lucene

google 的 lucene框架是一个全文搜索框架，本质是为搜索内容定位。





数据来源：

| 编号 | 数据来源                               |
| ---- | -------------------------------------- |
| 1    | 我是中国人                             |
| 2    | 中国是全球人口最多的国家，中国人也最多 |

如果搜索中国，sql like处理起来在数据量大的时候比较慢。

正排索引：

把整篇文章或字符串拆词，eg: 我、是、 中国， 中国人。 

缺点： 相同词会变多如(中国，中国人)，数据量检索会变多。

倒排索引：

```
1, 我(1：1) {0}  # 我在第一行出现一次，位置(偏移量)在0处。
2, 中国{1:1} {2}, (2:2){0,15} # 中国在第一行出现一次，偏移量在2处，中国在第二行出现两次，偏移量在0，15
```

总结：

文档 -> 关键词的映射过程（正向索引）

关键词-> 文档的映射（把正向索引的结果重新构造成倒排索引，反向索引)

Lucene的实现原理就基于 倒排索引 实现的，先分词，然后索引。



### ES

上方的倒排索引的数据要封装成一种形式，才能提交给es, 可称之为文档对象或document：

```
# 里面有一堆属性，称之为field
content: 我是中国人
size: 400
path: c:/text.txt , 数据库或url 或其它
time:
其他属性，分词，索引，保存等。
```



具体过程：

```
        document                                            index               client
+----------------------------+         +---------+       +--------+     +---------------------+
|                            |         |         |       |        |     |                     |
|                            |         |         |       |       <+------+   中国              |
| content:我是中国人           |         |         |       |中国{1:1}{2}  |                     |
| size: 400                  |         |         |       |      + |     +---------------------+
| path: c:/text.txt , 数据库或url 或其它 |  过滤    |       |      | |
| time:                      |         |  分词等  |       |      | |             document
| 其他属性:分词，索引，保存等。  |         |         |       |      | |     +----------------------+
|                           +----------->        +-------->     | |     |                      |
|                            |         |         |       |      | |     | # 原document丢弃      |
|                            |         |         |       |      | |     | document_id  # 一个index对应一个id
|                            |         |         |       |      | |     | 选择一些属性来存。      |
|                            |         |         |       |      | |     |                      |
|                            |         |         |       |      +------>|path: 数据库，文件，url |
|                            |         |         |       |        |     +----------------------+
+----------------------------+         +---------+       +--------+

```

Path 一般不是存的具体数据，而是数据源的位置。



多节点 多lucene

hash 取模节点数得节点id, 稳定算法，

sharding 横向扩展，

纵向高可用。