## Linux 磁盘和内存

### 磁盘

#### 查看磁盘容量-df

`$ df -h`

加上参数-h是以更易读的方式展示，以兆或者g来显示。

#### 查看目录容量 du

`$ du -h`

`$ du -h -d 0` 只看一级目录的信息

`$ du -h -d 1`只看二级目录的信息

#### 分区

`sudo fdisk l` 可看磁盘情况

`sudo fdisk sdb`对sdb进行分区，接下来会提示你按下m获得详细帮助

#### 格式化（创建文件系统）

在linux中把格式化叫创建文件系统

`sudo mkfs -t ext3 /dev/sdb1`

t指格式化的类型type为ext3,后面为指定分区

#### 挂载

没挂载的会显示黄色，代表块文件，需要挂载将其编成目录

`mount -t ext3 /dev/sdb1 /mnt/sdb`

将sdb1 挂载成mnt的sdb,

`mount sdb`常看sdb的挂载信息

#### 卸载

`unmount mnt/sdb`



#### RAID

容错廉价磁盘队列，将多个较小磁盘来扩展服务器的容量，不只是为了存储数据，还为了保护数据。

根据实现方式，RAID有几个等级：

* RAID-0（等量模式）：性能最佳

  就是说数据存储的时候分成几个和磁盘数量相等的份数，比如有个100M的文件，用5块磁盘来存储数据，那么每块盘将分得20M，存文件时将会循环遍历每块盘，如果小的盘慢了就存大的。 

  显然，这种方式，一旦有一块磁盘坏掉了，其他磁盘的数据也恢复不出来原本的文件。

* RAID-1 (映像模式)：完整备份。

   两份同样的磁盘，数据在存储的时候会一块盘会完全备份，比如上面的100M的文件，100M存一份磁盘，再用相同的另一份磁盘来存备份这100M,总共用了200M的容量。

  显然这种方式虽然保证了数据的恢复性，但是牺牲掉太多空间了。

* RAID 0+1 , RAID 1+0

  上面两种方式的结合，比如现在有现在有四份盘：ABCD

  0+1: A+B，C+D组成RAID 0,  然后将两份RAID0 组成RAID1

  1+0:  A+B,  C+D组成RAID 1,  然后将两份RAID0 组成RAID0

* RAID 5: 性能和备份的均衡考虑

  至少三块盘能实现，两块盘组成RAID-0的模式，不过在存储数据的时候会存同位检查码，如果有一块坏掉了可以用这个检查码来恢复数据，另一块做空着，当有磁盘坏掉了自动替换坏的磁盘，数据也会因为检查码来恢复到这个磁盘上。

  但是只能支持一块坏掉的盘，如果支持坏掉两块盘就是另一种模式RAID 6.

  如果盘坏掉，还得手动安装，停掉服务等，有一种自动回复的方式就是用Spare Disk,它在磁盘阵列中，但是平时 不会用，只有某块磁盘坏掉的时候，它会自动替换磁盘。

#### 软硬件RAID

上面说了一堆，这种磁盘管理方式是好，但是明显是硬件上的区分，是的，但是这种盘太贵了。。

所以说通过软件来实现这种逻辑。

我们的Centos提供的这种软件为mdadm.

它以分区和磁盘为单位，也就是说我们不需要多块硬盘，只要有两个分区以上就可以实现软件磁盘阵列了。

在系统中/dev/sd[a-p]标识的为硬件磁盘阵列

/dev/md[数字]  为软件磁盘阵列



### 内存

#### free

当前内存的使用情况

#### buffer和cache

对于操作系统来说：

```
buffer（缓冲）是为了提高内存和硬盘（或其他I/O设备）之间的数据交换的速度而设计的。 cache（缓存）是为了提高cpu和内存之间的数据交换速度而设计的，也就是平常见到的一级缓存、二级缓存
```

对于linux系统来说：free命令会显示buffers和cached

buffers与cached都是内存操作，用来保存系统曾经打开过的文件以及文件属性信息，这样当操作系统需要读取某些文件时，会首先在buffers 与cached内存区查找。

　　buffers是用来缓冲块设备做的，它只记录文件系统的元数据（metadata）以及 tracking in-flight pages，而cached是用来给文件做缓冲。更通俗一点说：buffers主要用来存放目录里面有什么内容，文件的属性以及权限等等。而cached直接用来记忆我们打开过的文件和程序。

所以一般cache会比较大。