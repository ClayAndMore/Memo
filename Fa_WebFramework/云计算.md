云计算有三个层次。

以及对应层次的代表产品。

* IaaS（Infrastructure-as-a-Service），即提供计算机本身基本的计算能力（物理形式或虚拟形式）、存储（通常是磁盘）、计算。

  亚马逊 Web 服务（Amazon Web Services，AWS）提供了弹性计算云（Elastic Compute Cloud，EC2)，以及简单存储系统（Simple Storage System，S3）服务，这两者就在 IaaS 层面。

  Google 也提供了 IaaS 存储服务，称为 Google Cloud Storage。

* Paas（Platform-as-a-Service） ，称为 这一层为用户的应用提供执行平台。

  Google App Engine 作为这一层

* SaaS（Software-as-a-Service），在这一层，用户只须简单地访问应用，这些应用位于本地，但只能通过因特网访问。SaaS 的例子包括基于 Web的电子邮件服务，如 Gmail、Yahoo! Mail 和 Hotmail。







##  

设当前目录为 root

1. mount bind root root 

   为了使当前root的老root和新root不在同一个文件系统 下，把root重新挂载一遍，bind 会时后root文件夹挂载到自己前root， 这里也就是挂载到自己身上， 是把相同内容换 了一个挂载点的挂载方法。

2. 创建.privot_root文件夹存储旧的root

3. 调用系统方法，`syscall.PivotRoot(root, pivotDir)`,  

4. 到根目录/, 上述调用后根目录在原来看就是root目录。

5. umount /.privot_root 并删除。

6. mount -t proc /proc proc

7. mount -t tmpfs /dev tmpfs

8. 下载好的busybox 放到 /root/busybox ，执行上述进程



proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。用户和应用程序可以通过proc得到系统的信息，并可以改变内核的某些参数.

tmpfs是Linux/Unix系统上的一种基于内存的虚拟文件系统。tmpfs可以使用您的内存或swap分区来存储文件(即它的存储空间在virtual memory 中, VM由real memory和swap组成)。由此可见，tmpfs主要存储暂存的文件。

它有如下2个优势 : 

1. 动态文件系统的大小。
2. tmpfs 使用VM建的文件系统，速度当然快。
3. 重启后数据丢失。



### AUFS 包装 busybox

上述实现了宿主机/root/busybox 作为文件的根目录， 但在容器内对文件的操作仍然会影响到宿主机的/root/busybox目录。

需要实现在容器中的操作不会对镜像产生任何影响的功能。

1. 创建 busybox 文件夹， busybox.tar 解压到busybox 目录下，作为容器的只读层。
2. 创建 writeLayer 文件夹作为可写层。
3. 创建mnt 文件夹作为挂载点，
4. `mount -t aufs -o dirs=wirteLayer:busyboxy none mnt`
5. 将原来的宿主机目录/root/busybox 换成 /root/mnt, 使用AUFS的方式就完成了。
6. 退出容器，umount mnt, 删除mnt, 删除writeLayer.





### 实现 volume 

1. -v 参数 得到 宿主机文件目录URL ，我们称之为 parentUrl
2. 宿主机创建 /root/parentUrl
3. 容器文件系统里创建挂载点 `/root/mnt/containerUrl(parentUrl)`
4. `mount -t aufs -o dirs=/root/partentUrl none /root/mnt/contailnerURl   `
5. 正常启动容器
6. 退出时， umount contailnerUrl, umount /root/mnt  删除、root mnt





### 镜像打包

